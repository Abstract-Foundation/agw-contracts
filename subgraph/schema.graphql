type Total @entity {
  "0x746f74616c"
  id: Bytes!
  createdAccounts: Int!
  deployedAccounts: Int!
  transactions: Int!
  backedUp: Int!
  gasSponsored: BigInt!
}

type Week @entity {
  "week start timestamp"
  id: Bytes!
  createdAccounts: Int!
  deployedAccounts: Int!
  activeAccounts: Int!
  transactions: Int!
  swappedTo: [WeeklySwappedTo!]! @derivedFrom(field: "week")
}

type Month @entity {
  "month start timestamp concat 0x00"
  id: Bytes!
  createdAccounts: Int!
  deployedAccounts: Int!
  activeAccounts: Int!
  transactions: Int!
  swappedTo: [MonthlySwappedTo!]! @derivedFrom(field: "month")
}

type WeeklySwappedTo @entity {
  "week.id.concat(erc20.id)"
  id: Bytes!
  week: Week!
  erc20: ERC20!
  amount: BigInt!
}

type MonthlySwappedTo @entity {
  "month.id.concat(erc20.id)"
  id: Bytes!
  month: Month!
  erc20: ERC20!
  amount: BigInt!
}

type WeekAccount @entity(immutable: true) {
  "account.id.concat(week.id)"
  id: Bytes!
  account: ClaveAccount!
  week: Week!
}

type MonthAccount @entity(immutable: true) {
  "account.id.concat(month.id)"
  id: Bytes!
  account: ClaveAccount!
  month: Month!
}

type ClaveAccount @entity {
  "account address"
  id: Bytes!
  creationDate: BigInt!
  deployDate: BigInt
  recoveryCount: Int!
  hasRecovery: Boolean!
  isRecovering: Boolean!
  txCount: Int!
  "account implementation address"
  implementation: Bytes
  erc20balances: [ERC20Balance!]! @derivedFrom(field: "account")
  owners: [Owner!]! @derivedFrom(field: "account")
  transactions: [ClaveTransaction!]! @derivedFrom(field: "sender")
  inAppSwaps: [InAppSwap!]! @derivedFrom(field: "account")
  activeWeeks: [WeekAccount!]! @derivedFrom(field: "account")
}

type ERC20 @entity {
  "token address"
  id: Bytes!
  name: String!
  symbol: String!
  decimals: Int!
  totalAmount: BigInt!
}

type ERC20Balance @entity {
  "account.id.concat(ERC20.id)"
  id: Bytes!
  account: ClaveAccount!
  token: ERC20!
  amount: BigInt!
}

enum OwnerType {
  "k1"
  Address
  "r1"
  PublicKey
}

type Owner @entity(immutable: true) {
  "account.id.concat(owner)"
  id: Bytes!
  account: ClaveAccount!
  "k1 or r1"
  ownerType: OwnerType!
  "public key or address"
  owner: Bytes!
  "date added as owner to account"
  dateAdded: BigInt!
}

enum Paymaster {
  None
  ERC20
  Gasless
}

type ClaveTransaction @entity(immutable: true) {
  "transaction hash"
  id: Bytes!
  "tx.from"
  sender: ClaveAccount!
  "tx.to"
  to: Bytes
  "tx.value"
  value: BigInt!
  "tx.gasPrice * tx.gasUsed"
  gasCost: BigInt!
  "type of paymaster used"
  paymaster: Paymaster!
  "block.timestamp"
  date: BigInt!
}

type InAppSwap @entity(immutable: true) {
  id: Bytes!
  account: ClaveAccount!
  tokenIn: Bytes!
  amountIn: BigInt!
  tokenOut: Bytes!
  amountOut: BigInt!
  date: BigInt!
}
